---
import { Image } from 'astro:assets';
const { title, text } = Astro.props;
import testPostPic1 from '../../src/assets/blog/grd-test-1.png';
import testPostPic2 from '../../src/assets/blog/grd-test-2.png';
import testPostPic3 from '../../src/assets/blog/grd-test-9.png';
import testPostPic4 from '../../src/assets/blog/grd-test-4.png';
import testPostPic5 from '../../src/assets/blog/grd-test-5.png';
import testPostPic6 from '../../src/assets/blog/grd-test-6.png';
import testPostPic7 from '../../src/assets/blog/grd-test-7.png';
import testPostPic8 from '../../src/assets/blog/grd-test-8.png';

import { getLatestPosts } from '../lib/wordpress';

const posts = await getLatestPosts(8);

function formatPostDate(dateString) {
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year} - ${month} - ${day}`;
}

const postsDummy = [
    { 
        image: testPostPic1, 
        title: 'Branding for Start Up Malta: How Early Stage Brands Build Trust, Clarity, and Investor Confidence',
        shortTitle: 'Startup Branding That Builds Trust',
        date: '2025.10.03' 
    },
    { 
        image: testPostPic2, 
        title: 'Branding for B2B Malta: How to Build Authority, Trust, and Long Term Relationships',
        shortTitle: 'B2B Branding That Builds Trust',
        date: '2025.9.05' 
    },
    { 
        image: testPostPic3, 
        title: 'Building Scalable iGaming Platforms Through UX Design',
        shortTitle: 'Scaling iGaming Platforms Through UX',
        date: '2025.9.05' 
    },
    { 
        image: testPostPic4, 
        title: 'Why Bespoke iGaming Websites in Malta Outperform Templates',
        shortTitle: 'Why Custom iGaming Sites Win',
        date: '2025.11.02' 
    },
    { 
        image: testPostPic5, 
        title: 'The Evolution of iGaming Marketing in Malta: From Acquisition to Retention',
        shortTitle: 'How iGaming Marketing Evolved',
        date: '2025.10.03' 
    },
    { 
        image: testPostPic6, 
        title: 'Mastering iGaming UX/UI Design in Malta',
        shortTitle: 'Mastering iGaming UX in Malta',
        date: '2025.9.05' 
    },
    { 
        image: testPostPic7, 
        title: 'Branding for Start Up Malta: How Early Stage Brands Build Trust, Clarity, and Investor Confidence',
        shortTitle: 'Startup Branding That Builds Trust',
        date: '2025.10.03'  
    },
    { 
        image: testPostPic8, 
        title: 'Branding for B2B Malta: How to Build Authority, Trust, and Long Term Relationships',
        shortTitle: 'B2B Branding That Builds Trust',
        date: '2025.9.05' 
    },
];

---

<section class="home-insights sc-pd sc-grey sc-grey-C sc-al-cnt ps-rel">
    <div class="container">
        <div class="sc-wrapper">
            <div class="headline ps-rel">
                <h2 class="txt-anim">{title}</h2>
                <div class="sc-txt txt-anim">
                    <p>{text}</p>
                </div>
            </div>
        </div>
        <div class="posts-grid-wrap" id="masonry-grid">
            {posts.map((post) => {
                const imageOld = post._embedded?.['wp:featuredmedia']?.[0]?.source_url;
                const imageNew = post.acf_image_style?.source_url;
                const imageToUse = imageNew || imageOld;
                const shortTitle = post.acf.short_title;

                return (
                    <div class="post-card">
                        <a href={`/blog/${post.slug}/`}>
                            <div 
                                class="post-image ps-rel"
                                style={{
                                    backgroundImage: `url(${imageToUse})`,
                                    backgroundSize: 'cover',
                                    backgroundPosition: 'center',
                                    backgroundRepeat: 'no-repeat'
                                }}
                            >
                                <div class="post-short-title fx fx-jc ps-rel">
                                    <h5>{shortTitle}</h5>
                                </div>
                            </div>
                            <div class="post-info">
                                <h6>{post.title.rendered}</h6>
                                <p>{formatPostDate(post.date)}</p>
                            </div>
                        </a>
                    </div>
                );
            })}
        </div>
        <div class="btn-row fx fx-jc">
            <a href="/blog" class="btn-primary btn-dark fx fx-ac fx-jc"><span>Read Articles</span></a>
        </div>
    </div>
</section>

<style>
    .home-insights{
        overflow: hidden; 
    }
    .post-short-title{
        padding: 2rem 0 4rem 0;
        z-index: 1;
        min-height: 12rem;
    }
    .post-short-title h5{
        font-size: 3.25rem;
        line-height: 3.5rem;
        padding: 0 2rem;
        font-weight: 500;
        font-family: 'pp_neue_montrealmedium';
        color: var(--darkGrey);
    }
    .post-card .post-image:before{
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.4);
        z-index: 1;
    }
    .post-image{
        max-height: unset;
    }
    @media screen and (max-width:1000px){
        .post-short-title h5 {
            padding: 0 16px;
        }
    }
    @media screen and (max-width:479px){
        .sc-wrapper {
            padding: 0 16px;
        }
    }
    
</style>

<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js" defer></script>
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js" defer></script>
<script type="module" client:visible>
    import initMasonry from '/js/MasonryGrid.js';
    initMasonry('#masonry-grid');
    initMasonry('#masonry-grid-2');
    initMasonry('#masonry-grid-3');
</script>