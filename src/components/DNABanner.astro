---
const { title, text } = Astro.props;
---

<section class="sc-hero banner-vd" id="dna-hero">
    <div class="sc-hero-vd">
        <video id="dna-video" muted playsinline autoplay>
            <source src="/vd/dna-full-spin-low.mp4" type="video/mp4">
        </video>
    </div>
    <div class="sc-dna-intro">
        <div class="container">
            <div class="dna-sc-wrap sc-al-cnt">
                <h1 set:html={title}></h1>
                <div class="sc-txt">
                    <p set:html={text}></p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .sc-hero{
        padding-bottom: 8.75rem;
    }
    video{
        width: 100%;
        height: auto;
        object-fit: cover;
    }
    .sc-dna-intro{
        margin-top: 7.5rem;
    }
    .dna-sc-wrap{
        width: 60rem;
        margin: auto;
    }
</style>

<script>
  const video = document.getElementById('dna-video');

  video.addEventListener('loadedmetadata', () => {
    const halfDuration = video.duration / 2;
    let scrollEnabled = false;

    // --- Step 1: Play first half automatically ---
    video.currentTime = 0;
    video.play();

    const firstHalfInterval = setInterval(() => {
      if (video.currentTime >= halfDuration) {
        video.pause();          // stop at half
        scrollEnabled = true;   // enable scroll control
        clearInterval(firstHalfInterval);
      }
    }, 50);

    // --- Step 2: Scroll-driven control for second half ---
    window.addEventListener('scroll', () => {
      if (!scrollEnabled) return; // ignore scroll until first half finishes

      const scrollTop = window.scrollY;
      const maxScroll = document.body.scrollHeight - window.innerHeight;
      const scrollFraction = Math.min(Math.max(scrollTop / maxScroll, 0), 1);

      if (scrollFraction === 0) {
        // At top: reset to first frame
        video.currentTime = 0;
      } else {
        // Map scrollFraction to second half
        video.currentTime = halfDuration + scrollFraction * halfDuration;
      }
    });
  });
</script>
