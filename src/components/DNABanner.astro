---
const { title, text } = Astro.props;
---

<section class="sc-hero banner-vd" id="dna-hero">
    <div class="sc-hero-vd" id="hero-vd-container"></div>
    <div class="sc-dna-intro">
        <div class="container">
            <div class="dna-sc-wrap sc-al-cnt">
                <h1 set:html={title}></h1>
                <div class="sc-txt">
                    <p set:html={text}></p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
	.sc-hero{
		padding-bottom: 8.75rem;
	}
	.sc-hero-vd {
		position: sticky;
		top: 0;
		overflow: hidden;
		will-change: transform;
	}
	video{
		width: 100%;
		height: auto;
		object-fit: cover;
	}
	.sc-dna-intro{
		margin-top: 7.5rem;
	}
	.dna-sc-wrap {
		width: 60rem;
		margin: auto;
	}
	@media screen and (max-width: 1000px) {
		.dna-sc-wrap {
			width: 100%;
		}
		.sc-dna-intro{
			margin-top: 40px;
		}
		.dna-sc-wrap .sc-txt {
			width: 447px;
			margin-left: auto;
			margin-right: auto;
		}
		.sc-hero{
			padding-bottom: 40px;
		}
	}
	@media screen and (max-width: 479px) {
		.dna-sc-wrap .sc-txt {
			width: 100%;
		}
		.dna-sc-wrap {
			padding: 0 16px;
		}
	}
</style>

<script>
	const totalFrames = 41;
	const introFrames = 20;
	const container = document.getElementById('hero-vd-container');
	const images = [];

	// --- Preload all frames ---
	for (let i = 1; i <= totalFrames; i++) {
		const img = new Image();
		img.src = `/frames/frame${i}.png`; 
		img.style.display = "none";
		img.style.width = "100%";
		img.style.height = "auto";
		img.style.objectFit = "cover";
		container.appendChild(img);
		images.push(img);
	}

	images[0].style.display = "block";

	let currentFrame = 0;
	let targetFrame = 0;
	let introPlaying = true;

	// --- Auto-play first 20 frames ---
	function playIntro() {
		if (currentFrame < introFrames - 1) {
			images[currentFrame].style.display = "none";
			currentFrame++;
			images[currentFrame].style.display = "block";
			requestAnimationFrame(playIntro);
		} else {
			introPlaying = false;
			targetFrame = introFrames;
		}
	}

	playIntro();

	// --- Scroll-driven frames 21-41 ---
	const section = document.getElementById("dna-hero");
	const stickyContainer = document.querySelector(".sc-hero-vd");

	// Make the container sticky
	stickyContainer.style.position = "sticky";
	stickyContainer.style.top = "0";

	window.addEventListener("scroll", () => {
		if (introPlaying) return;

		const rect = section.getBoundingClientRect();
		const windowHeight = window.innerHeight;

		// Calculate scrollFraction only while section is in viewport
		// 0 = top of section at top of viewport
		// 1 = bottom of section at top of viewport
		const sectionScroll = Math.min(Math.max(-rect.top / (rect.height - windowHeight), 0), 1);

		// Map scroll fraction to frames 21-41
		targetFrame = introFrames + Math.floor(sectionScroll * (totalFrames - introFrames - 1));
	});

	// --- Smooth animation loop ---
	function animateFrames() {
		if (!introPlaying) {
			currentFrame += (targetFrame - currentFrame) * 0.15; // lerp for smooth transition
			const displayIndex = Math.round(currentFrame);

			images.forEach((img, i) => {
			img.style.display = i === displayIndex ? "block" : "none";
			});
		}

		requestAnimationFrame(animateFrames);
	}

	animateFrames();
</script>
