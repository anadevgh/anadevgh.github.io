---
const { title, text } = Astro.props;
---

<section class="sc-hero banner-vd" id="dna-hero">
    <div class="sc-hero-vd" id="hero-vd-container">
		<img id="hero-frame" src="/frames/opt/frame1.webp" loading="eager" />
	</div>
    <div class="sc-dna-intro">
        <div class="container">
            <div class="dna-sc-wrap sc-al-cnt">
                <h1 class="txt-anim" set:html={title}></h1>
                <div class="sc-txt txt-anim">
                    <p set:html={text}></p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
	.sc-hero{
		padding-bottom: 8.75rem;
	}
	#hero-frame {
		width: 100%;
		height: auto;
		object-fit: cover;
		display: block;
	}
	.sc-hero-vd {
		position: sticky;
		top: 0;
		overflow: hidden;
		will-change: transform;
	}
	video{
		width: 100%;
		height: auto;
		object-fit: cover;
	}
	.sc-dna-intro{
		margin-top: 7.5rem;
	}
	.dna-sc-wrap {
		width: 60rem;
		margin: auto;
	}
	@media screen and (max-width: 1000px) {
		.dna-sc-wrap {
			width: 100%;
		}
		.sc-dna-intro{
			margin-top: 40px;
		}
		.dna-sc-wrap .sc-txt {
			width: 447px;
			margin-left: auto;
			margin-right: auto;
		}
		.sc-hero{
			padding-bottom: 40px;
		}
		.sc-hero-vd {
			padding: 50px 0 60px 0;
		}
	}
	@media screen and (max-width: 479px) {
		.dna-sc-wrap .sc-txt {
			width: 100%;
		}
		.dna-sc-wrap {
			padding: 0 16px;
		}
	}
</style>

<script>
	const totalFrames = 41;
	const introFrames = 20;
	const frameElement = document.getElementById('hero-frame');

	const images = [];
	let currentFrame = 0;
	let targetFrame = 0;
	let introPlaying = true;

	// --- Load first frame immediately ---
	images[0] = new Image();
	images[0].src = '/frames/opt/frame1.webp';
	images[0].onload = () => frameElement.src = images[0].src;

	// --- Function to load intro frames sequentially ---
	function loadIntroFrame(index) {
	if (index >= introFrames) {
		introPlaying = false;
		targetFrame = introFrames;
		preloadRemainingFrames();
		return;
	}

	images[index] = new Image();
	images[index].src = `/frames/opt/frame${index + 1}.webp`;
	images[index].onload = () => {
		currentFrame = index;
		frameElement.src = images[index].src;
		requestAnimationFrame(() => loadIntroFrame(index + 1));
	};
	}

	// Start intro animation
	loadIntroFrame(1);

	// --- Lazy-load the remaining frames ---
	function preloadRemainingFrames() {
	for (let i = introFrames; i < totalFrames; i++) {
		const img = new Image();
		img.src = `/frames/opt/frame${i + 1}.webp`;
		images[i] = img;
	}
	}

	// --- Scroll-driven frames 21-41 ---
	const section = document.getElementById("dna-hero");

	window.addEventListener("scroll", () => {
	if (introPlaying) return;

	const rect = section.getBoundingClientRect();
	const windowHeight = window.innerHeight;
	const sectionScroll = Math.min(Math.max(-rect.top / (rect.height - windowHeight), 0), 1);

	targetFrame = introFrames + Math.floor(sectionScroll * (totalFrames - introFrames - 1));
	});

	// --- Smooth animation loop ---
	function animateFrames() {
	if (!introPlaying) {
		currentFrame += (targetFrame - currentFrame) * 0.15;
		const displayIndex = Math.round(currentFrame);
		if (images[displayIndex]) frameElement.src = images[displayIndex].src;
	}
	requestAnimationFrame(animateFrames);
	}

	animateFrames();
</script>