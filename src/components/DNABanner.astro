---
const { title, text } = Astro.props;
---

<section class="sc-hero banner-vd" id="dna-hero">
    <div class="sc-hero-vd" id="hero-vd-container">
		<img id="hero-frame" />
	</div>
    <div class="sc-dna-intro">
        <div class="container">
            <div class="dna-sc-wrap sc-al-cnt">
                <h1 set:html={title}></h1>
                <div class="sc-txt">
                    <p set:html={text}></p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
	.sc-hero{
		padding-bottom: 8.75rem;
	}
	#hero-frame {
		width: 100%;
		height: auto;
		object-fit: cover;
		display: block;
	}
	.sc-hero-vd {
		position: sticky;
		top: 0;
		overflow: hidden;
		will-change: transform;
	}
	video{
		width: 100%;
		height: auto;
		object-fit: cover;
	}
	.sc-dna-intro{
		margin-top: 7.5rem;
	}
	.dna-sc-wrap {
		width: 60rem;
		margin: auto;
	}
	@media screen and (max-width: 1000px) {
		.dna-sc-wrap {
			width: 100%;
		}
		.sc-dna-intro{
			margin-top: 40px;
		}
		.dna-sc-wrap .sc-txt {
			width: 447px;
			margin-left: auto;
			margin-right: auto;
		}
		.sc-hero{
			padding-bottom: 40px;
		}
	}
	@media screen and (max-width: 479px) {
		.dna-sc-wrap .sc-txt {
			width: 100%;
		}
		.dna-sc-wrap {
			padding: 0 16px;
		}
	}
</style>

<script>
  const totalFrames = 41;
const introFrames = 20;
const frameElement = document.getElementById('hero-frame');

const images = [];
let currentFrame = 0;
let targetFrame = 0;
let introPlaying = true;

// --- Preload all images in memory ---
for (let i = 1; i <= totalFrames; i++) {
    const img = new Image();
    img.src = `/frames/frame${i}.png`;
    images.push(img);
}

// Show first frame only when loaded
images[0].onload = () => frameElement.src = images[0].src;

// --- Auto-play first 20 frames ---
function playIntro() {
    if (currentFrame < introFrames - 1) {
        currentFrame++;
        frameElement.src = images[currentFrame].src;
        requestAnimationFrame(playIntro);
    } else {
        introPlaying = false;
        targetFrame = introFrames;
    }
}

playIntro();

// --- Scroll-driven frames 21-41 ---
const section = document.getElementById("dna-hero");

window.addEventListener("scroll", () => {
    if (introPlaying) return;

    const rect = section.getBoundingClientRect();
    const windowHeight = window.innerHeight;
    const sectionScroll = Math.min(Math.max(-rect.top / (rect.height - windowHeight), 0), 1);

    targetFrame = introFrames + Math.floor(sectionScroll * (totalFrames - introFrames - 1));
});

// --- Smooth animation loop ---
function animateFrames() {
    if (!introPlaying) {
        currentFrame += (targetFrame - currentFrame) * 0.15;
        const displayIndex = Math.round(currentFrame);
        frameElement.src = images[displayIndex].src;
    }
    requestAnimationFrame(animateFrames);
}

animateFrames();
</script>

